DROP TABLE A2ERROREVENT;
CREATE TABLE A2ERROREVENT (
ERRORID       INTEGER,
SOURCE_ROWID  ROWID,
SOURCE_TABLE  VARCHAR2(30),
ERRORCODE     INTEGER,
FILTERID      INTEGER,
DATETIME      DATE,
ACTION        VARCHAR2(6),
CONSTRAINT    ERROREVENTACTION
CHECK (ACTION IN ('SKIP','MODIFY'))
);

DROP SEQUENCE A2ERROR_SEQ;
CREATE SEQUENCE A2ERROR_SEQ;

DROP TABLE DWPROD;
DROP TABLE DWCUST;
DROP TABLE DWSALE;

CREATE TABLE DWPROD (
DWPRODID      NUMBER(38),
DWSOURCETABLE VARCHAR2(30),
DWSOURCEID    INTEGER,
PRODNAME      VARCHAR2(100),
PRODCATNAME   VARCHAR2(38),
PRODMANUNAME  VARCHAR2(38),
PRODSHIPNAME  VARCHAR2(38),
PRIMARY KEY (DWPRODID)
);

DROP SEQUENCE DWPROD_SEQ;
CREATE SEQUENCE DWPROD_SEQ;

CREATE TABLE DWCUST  (
DWCUSTID        NUMBER(38),
DWSOURCEIDBRIS  INTEGER,
DWSOURCEIDMELB  INTEGER,
FIRSTNAME       VARCHAR2(30),
SURNAME         VARCHAR2(30),
GENDER          VARCHAR2(10),
PHONE           VARCHAR2(20),
POSTCODE        NUMBER(4),
CITY            VARCHAR(50),
STATE           VARCHAR2(10),
CUSTCATCODE     NUMBER(38),
PRIMARY KEY (DWCUSTID)
);

DROP SEQUENCE DWCUST_SEQ;
CREATE SEQUENCE DWCUST_SEQ;

CREATE TABLE DWSALE  (
DWSALEID        NUMBER(38),
DWCUSTID        NUMBER(38),
DWPRODID        NUMBER(38),
DWSOURCEIDBRIS  INTEGER,
DWSOURCEIDMELB  INTEGER,
QTY             NUMBER(2),
SALE_DWDATEID   NUMBER(38),
SHIP_DWDATEID   NUMBER(38),
SALEPRICE       NUMBER(7,2),
PRIMARY KEY (DWSALEID)
);

DROP SEQUENCE DWSALE_SEQ;
CREATE SEQUENCE DWSALE_SEQ;

DROP TABLE GENDERSPELLING; 

CREATE TABLE GENDERSPELLING (
INVALID_VALUE VARCHAR2(10),
NEW_VALUE VARCHAR2(10)
);

INSERT INTO GENDERSPELLING VALUES ('MAIL', 'M');
INSERT INTO GENDERSPELLING VALUES ('WOMAN', 'F');
INSERT INTO GENDERSPELLING VALUES ('FEM', 'F');
INSERT INTO GENDERSPELLING VALUES ('FEMALE', 'F');
INSERT INTO GENDERSPELLING VALUES ('MALE', 'M');
INSERT INTO GENDERSPELLING VALUES ('GENTLEMAN', 'M');
INSERT INTO GENDERSPELLING VALUES ('MM', 'M');
INSERT INTO GENDERSPELLING VALUES ('FF', 'F');
INSERT INTO GENDERSPELLING VALUES ('FEMAIL', 'F');


/*PART 2. PRODUCT TRANSFER
Task 2.1
filter #1 
a
*/
insert into A2ERROREVENT(ERRORID, SOURCE_ROWID,SOURCE_TABLE,ERRORCODE,FILTERID,DATETIME,ACTION)

select A2ERROR_SEQ.NEXTVAL,ROWID,'A2PRODUCT',105,1,SYSDATE,'SKIP' from A2PRODUCT where PRODNAME is null;
/*
b
*/
select * from A2ERROREVENT;

/*
TASK 2.2 
    FILTET #2
a
*/

insert into A2ERROREVENT(ERRORID, SOURCE_ROWID,SOURCE_TABLE,ERRORCODE,FILTERID,DATETIME,ACTION)

select A2ERROR_SEQ.NEXTVAL,ROWID,'A2PRODUCT',131,2,SYSDATE,'MODIFY' from A2PRODUCT where MANUFACTURERCODE is null;

/*
PART b  TESTING 
*/

SELECT * from A2ERROREVENT;

/*
TASK 2.3 
    FILTET #3
a
*/

insert into A2ERROREVENT(ERRORID, SOURCE_ROWID,SOURCE_TABLE,ERRORCODE,FILTERID,DATETIME,ACTION)

select A2ERROR_SEQ.NEXTVAL,ROWID,'A2PRODUCT',146,3,SYSDATE,'MODIFY' from A2PRODUCT 
where A2PRODUCT.PRODCATEGORY NOT IN
(SELECT A2PRODCATEGORY.PRODUCTCATEGORY FROM A2PRODCATEGORY) or
(PRODCATEGORY is null);

/*
PART b  TESTING 
*/

SELECT * from A2ERROREVENT;


/*
TASK 2.4.3 

a
*/


















